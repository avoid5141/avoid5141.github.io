<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deep Link Handler</title>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // 현재 URL에서 'link' 파라미터 추출
      const urlParams = new URLSearchParams(window.location.search);
      const link = urlParams.get("link");
      if (!link) {
        console.error("No 'link' parameter found in URL.");
        return;
      }

      // 플랫폼별 설정
      const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      const isAndroid = /Android/i.test(navigator.userAgent);

      const appScheme = "itwebsmartplan://avoid5141.github.io"; // 앱 딥링크 스킴
      const iosStoreUrl = "https://apps.apple.com/app/id123456789"; // iOS 앱스토어 URL
      const androidStoreUrl = "https://play.google.com/store/apps/details?id=com.example.app"; // Android 스토어 URL
      const fallbackStoreUrl = isIOS ? iosStoreUrl : androidStoreUrl;

      const deepLinkUrl = `${appScheme}?link=${encodeURIComponent(link)}`;

      // 수동 링크 설정
      const manualLink = document.getElementById("manual-link");
      manualLink.href = fallbackStoreUrl;
      manualLink.textContent = isIOS ? "Go to App Store" : "Go to Play Store";

      if (isIOS || isAndroid) {
        // 앱 실행 시도
        const startTime = Date.now();
        const iframe = document.createElement("iframe");
        iframe.style.display = "none";
        iframe.src = deepLinkUrl;
        document.body.appendChild(iframe);

        // 앱 설치 여부 확인
        setTimeout(() => {
          const elapsedTime = Date.now() - startTime;

          // iOS에서는 딥링크 호출 실패 시 바로 fallback이 발생하지 않으므로 시간 기반으로 처리
          if (elapsedTime < 2000) {
            window.location.href = fallbackStoreUrl;
          }
        }, 1500); // 1.5초 대기 후 스토어로 이동
      } else {
        // 지원되지 않는 플랫폼
        alert("This feature is only supported on iOS or Android devices.");
      }
    });
  </script>
</head>
<body>
  <h1>Redirecting...</h1>
  <p>If you are not redirected automatically, please <a id="manual-link">click here</a>.</p>
</body>
</html>
